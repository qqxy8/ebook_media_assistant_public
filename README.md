# Ebook Media Assistant

**版本：** v0.1.6

一个基于 PyQt5 的跨平台桌面应用，用于统一管理批量视频字幕压制、视频重命名、电子书推送等多种媒体处理任务，并支持自动后台运行与更新。

---

## 项目简介

Ebook Media Assistant（EMA）是一款基于 Python 与 PyQt5 开发的跨平台桌面应用，旨在帮助用户**自动化管理**本地视频与电子书文件。它能够：

- **实时监控**指定目录的新文件  
- **智能重命名**视频文件  
- **自动转换**各类电子书格式并清洗元数据  
- **压缩大文件**以节省空间  
- **一键推送**至 Kindle（通过邮件）  
- **自动上传**至云盘（如百度网盘）  
- **系统托盘**运行，支持消息通知与恢复操作  

---

## 主要特性

1. **单实例运行** —— 阻止重复启动  
2. **系统托盘图标** —— 一键打开设置、查看日志和退出  
3. **目录监控**  
   - 视频目录（支持 `.mp4/.mkv/.avi/.mov`）  
   - 电子书目录（支持 `.epub/.mobi/.azw3/.pdf`）  
4. **视频处理**  
   - 自动探测分辨率（360p–4K）  
   - 解析剧集编号（SxxExx 或独立数字）  
   - 按照用户配置（前缀、分组、编码、字幕等）重命名  
5. **电子书处理**  
   - 非 EPUB 自动调用 Calibre 转换  
   - 使用 `ebook-meta` 清洗并根据 “书名 – 作者” 重命名  
   - 文件大于 25 MB 时自动压缩为 ZIP  
6. **推送至 Kindle**  
   - 自动识别 SMTP 配置（Gmail、QQ、Outlook 等）  
   - 通过邮件发送至用户输入的 Kindle 邮箱  
   - 推送后自动压缩并归档  
7. **自动上传云盘**  
   - 在推送成功事件触发后，将压缩包移动到指定云盘同步目录  
   - 支持百度网盘等任意本地同步文件夹  
8. **更新检查**  
   - 后台定期拉取 GitHub 发布清单  
   - 检测到新版本后弹窗提示、一键更新  
9. **日志与恢复**  
   - 启动日志 `startup.log`  
   - 发生异常时可在托盘菜单中查看并恢复  

---

## 主要功能

- 📀 **批量压制字幕**：一键打开并批量调用字幕烧录工具  
- ✏️ **批量重命名视频**：按规则快速批量重命名视频文件  
- 📥 **资源恢复**：便捷恢复记录的媒体资源  
- ⚙️ **初始设置**：配置视频 & 电子书目录、Kindle 地址、邮箱推送等  
- 📤 **电子书推送**：选中 EPUB 文件，一键发送到 Kindle  
- 🔄 **后台运行**：首次运行后可最小化到系统托盘，常驻后台  
- 🚀 **自动更新**：启动时自动检查最新版本，并支持一键下载替换启动

---

## 系统需求

- Windows 10+ 或兼容系统  
- Python 3.7+（开发环境）  
- **可选依赖**：Win10toast 用于原生气泡提示（可自行安装）

---

## 安装与运行

1. **获取可执行文件**  
   从 GitHub Releases 下载最新版 `ebook_media_assistant.exe`。

2. **放置目录**  
   将 `ebook_media_assistant.exe` 与同目录下的 `assets/` 文件夹一并保留。

3. **双击启动**  
   - 首次运行会弹出设置窗口，完成后程序自动最小化到系统托盘。  
   - 点击任务栏右下角“^”可找到小船图标，右键打开功能菜单。

---

## 自动更新

程序启动后，会后台访问配置好的 `latest.json`：  
```json
{
  "version": "0.1.6",
  "url": "https://.../ebook_media_assistant.exe",
  "sha256": "...",
  "changelog": "• 新增自动更新功能"
}
```
如检测到新版本，弹出提示→自动下载→校验→替换旧版本→重启应用。

---

## 使用示例

1. 在资源管理器中选择多个视频文件夹，点击“添加视频”。  
2. 配置邮箱并测试发送，保存后配置写入 `config.json`。  
3. 关闭并再次启动，程序将保持后台监视并推送最新 EPUB。

---

## 常见问题

- **托盘图标看不到**：请点击任务栏“^”展开隐藏图标。  
- **更新失败**：检查网络及 `latest.json` 地址是否正确。  
- **缺少 win10toast**：可通过 `pip install win10toast` 安装，或忽略使用 Qt 气泡。

---

## 参与贡献
感谢以下贡献者：

qqxy8

cocobilibili

欢迎提交 Issue 或 Pull Request，地址：  
https://github.com/qqxy8/ebook_media_assistant_public

---

